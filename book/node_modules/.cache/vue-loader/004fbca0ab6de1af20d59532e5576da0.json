{"remainingRequest":"/Users/gaga/Desktop/文档/vue/Books/book/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/gaga/Desktop/文档/vue/Books/book/src/views/Userinfo.vue?vue&type=style&index=0&id=0cede0b3&scoped=true&lang=css&","dependencies":[{"path":"/Users/gaga/Desktop/文档/vue/Books/book/src/views/Userinfo.vue","mtime":1586683604959},{"path":"/Users/gaga/Desktop/文档/vue/Books/book/node_modules/css-loader/dist/cjs.js","mtime":1573815120679},{"path":"/Users/gaga/Desktop/文档/vue/Books/book/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1573815121359},{"path":"/Users/gaga/Desktop/文档/vue/Books/book/node_modules/postcss-loader/src/index.js","mtime":1573815121151},{"path":"/Users/gaga/Desktop/文档/vue/Books/book/node_modules/cache-loader/dist/cjs.js","mtime":1573815120526},{"path":"/Users/gaga/Desktop/文档/vue/Books/book/node_modules/vue-loader/lib/index.js","mtime":1573815121359}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLm1haW4gewogIHdpZHRoOiAxMDAlOwogIGhlaWdodDogMTAwJTsKICBwYWRkaW5nOiAxMHB4Owp9Ci5wYWdlIHsKICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgbWFyZ2luOiAxMHB4IDA7Cn0KLnRvcGxpc3QgewogIGRpc3BsYXk6IGZsZXg7Cn0K"},{"version":3,"sources":["Userinfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Userinfo.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"main\">\n    <div class=\"toplist\">\n      <Dropdown :style=\"{margin: '0 10px 10px 0px'}\" @on-click=\"selectMajor\">\n        <Button type=\"primary\">\n          {{majorName ? majorName : \"选择专业\" }}\n          <Icon type=\"ios-arrow-down\"></Icon>\n        </Button>\n        <DropdownMenu slot=\"list\" v-for=\"(item,index) in majorList\" :key=\"index\">\n          <DropdownItem :name=\"item\">{{item}}</DropdownItem>\n        </DropdownMenu>\n      </Dropdown>\n      <Dropdown :style=\"{margin: '0 10px 10px 0px'}\" @on-click=\"selectStatus\">\n        <Button type=\"primary\">\n          {{statusName ? statusName : \"选择状态\" }}\n          <Icon type=\"ios-arrow-down\"></Icon>\n        </Button>\n        <DropdownMenu slot=\"list\" v-model=\"statusName\">\n          <DropdownItem name=\"已逾期\">已逾期</DropdownItem>\n          <DropdownItem name=\"未逾期\">未逾期</DropdownItem>\n        </DropdownMenu>\n      </Dropdown>\n      <Button :style=\"{marginLeft:'5px'}\" type=\"primary\" @click=\"userAddFlag=true\">添加信息</Button>\n      <Button :style=\"{marginLeft:'15px'}\" type=\"primary\" @click=\"selectAll\">全部信息</Button>\n      <Input\n        v-model=\"username\"\n        :style=\"{width: 'auto',marginLeft: '15px'}\"\n        search\n        enter-button\n        placeholder=\"搜索借阅人...\"\n        @on-search=\"searchUserName\"\n      />\n    </div>\n    <Table border :columns=\"column\" :data=\"userdata\"></Table>\n    <div class=\"page\">\n      <Page\n        class=\"page\"\n        :total=\"total\"\n        show-total\n        :current.sync=\"currentPage\"\n        :page-size=\"pageSize\"\n        @on-change=\"changePage\"\n      />\n    </div>\n    <Modal v-model=\"userEditFlag\" width=\"500\">\n      <p slot=\"header\" style=\"text-align:center\">\n        <!-- <Icon type=\"ios-information-circle\"></Icon> -->\n        <span>修改借阅信息</span>\n      </p>\n      <div>\n        <UserEdit\n          @toParent=\"initial\"\n          @closeWin=\"closewin\"\n          :userData=\"editUserDataAsync\"\n          v-if=\"JSON.stringify(editUserDataAsync) !== '{}'\"\n        ></UserEdit>\n      </div>\n      <div slot=\"footer\"></div>\n    </Modal>\n    <Modal v-model=\"userAddFlag\" width=\"500\">\n      <p slot=\"header\" style=\"text-align:center\">\n        <!-- <Icon type=\"ios-information-circle\"></Icon> -->\n        <span>添加借阅信息</span>\n      </p>\n      <div>\n        <UserAdd @toParent=\"initial\" @closeWin=\"closewin\"></UserAdd>\n      </div>\n      <div slot=\"footer\"></div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport { getUser, delUserData } from \"@/api/index\";\nimport UserEdit from \"@/components/userinfo/useredit\";\nimport UserAdd from \"@/components/userinfo/useradd\";\nexport default {\n  components: {\n    UserEdit,\n    UserAdd\n  },\n  data() {\n    return {\n      userEditFlag: false,\n      userAddFlag: false,\n      username: \"\",\n      editUserDataAsync: {},\n\n      alluserdata: [],\n      userdata: [],\n      column: [\n        {\n          title: \"借阅人\",\n          key: \"name\",\n          align: \"center\"\n        },\n        {\n          title: \"学号\",\n          key: \"schoolNumber\",\n          align: \"center\"\n        },\n        {\n          title: \"联系方式\",\n          key: \"phoneNumber\",\n          align: \"center\"\n        },\n        {\n          title: \"专业\",\n          key: \"major\",\n          align: \"center\"\n        },\n        {\n          title: \"借阅书籍\",\n          key: \"bookName\",\n          align: \"center\",\n          render: (h, params) => {\n            return h(\"p\", `<< ${params.row.bookName} >>`);\n          }\n        },\n        {\n          title: \"借阅日期\",\n          key: \"date\",\n          align: \"center\"\n          // render: (h, params) => {\n          //   console.log( new Date(params.row.date)/1000  )\n          //   return h(\"p\", `<< ${params.row.date} >>`);\n          // }\n        },\n        {\n          title: \"还书日期\",\n          key: \"date\",\n          align: \"center\",\n          render: (h, params) => {\n            //格式化日期\n            function formatDate(date) {\n              var date = new Date(date * 1000);\n              var YY = date.getFullYear() + \"-\";\n              var MM =\n                (date.getMonth() + 1 < 10\n                  ? \"0\" + (date.getMonth() + 1)\n                  : date.getMonth() + 1) + \"-\";\n              var DD =\n                date.getDate() < 10 ? \"0\" + date.getDate() : date.getDate();\n\n              return YY + MM + DD;\n            }\n\n            var borrowDate = Math.round(new Date(params.row.date) / 1000); //结束日期\n            var backDate = borrowDate + 86400 * 15; //根据借书日期计算出归还日期\n            var currentDate = new Date() / 1000; //当前日期\n  \n            // var countDay=\n            // console.log(formatDate(backDate));\n            return h(\"p\", `${formatDate(backDate)}`);\n          }\n        },\n        {\n          title: \"还书期限\",\n          key: \"date\",\n          align: \"center\",\n          render: (h, params) => {\n            var borrowDate = Math.round(new Date(params.row.date) / 1000); //结束日期\n            var backDate = borrowDate + 86400 * 15; //根据借书日期计算出归还日期\n            var currentDate = new Date() / 1000; //当前日期\n            var countDay =\n              backDate - currentDate > 0\n                ? Math.round((backDate - currentDate) / 86400) + \"天\"\n                : \"已经逾期\";\n            var fontColor = backDate - currentDate > 0 ? \"green\" : \"red\";\n            return h(\"p\", { style: { color: fontColor } }, ` ${countDay}`);\n          }\n        },\n        {\n          title: \"操作\",\n          key: \"action\",\n          width: 150,\n          align: \"center\",\n          render: (h, params) => {\n            return h(\"div\", [\n              h(\n                \"Button\",\n                {\n                  props: {\n                    type: \"primary\",\n                    size: \"small\"\n                  },\n                  style: {\n                    marginRight: \"5px\"\n                  },\n                  on: {\n                    click: () => {\n                      this.editUserDataAsync = JSON.parse(\n                        JSON.stringify(params.row)\n                      );\n                      this.userEditFlag = true;\n                    }\n                  }\n                },\n                \"修改\"\n              ),\n              h(\n                \"Button\",\n                {\n                  props: {\n                    type: \"success\",\n                    size: \"small\"\n                  },\n                  style: {\n                    marginRight: \"5px\"\n                  },\n                  on: {\n                    click: () => {\n                      this.$Modal.confirm({\n                        title: \"提示\",\n                        content: \"<p>确定该借阅人已归还书籍了吗?</p>\",\n                        onOk: () => {\n                          delUserData({ name: params.row.name }).then(res => {\n                            if (res.code == 1) {\n                              this.$Message.success(res.msg);\n                              this.selectAll();\n                            } else {\n                              this.$Message.error(res.msg);\n                            }\n                          });\n                        },\n                        onCancel: () => {\n                          // this.$Message.info(\"Clicked cancel\");\n                        }\n                      });\n                    }\n                  }\n                },\n                \"归还\"\n              )\n            ]);\n          }\n        }\n      ],\n      //分页\n      currentPage: 1,\n      total: 0,\n      pageSize: 8,\n\n      //搜索借阅人\n      majorName: \"\",\n      majorList: [],\n\n      //选择状态\n      statusName: \"\",\n      statusList: [],\n\n      //书籍目录\n      bookNameList: []\n    };\n  },\n\n  mounted() {\n    this.initial();\n  },\n  methods: {\n    closewin() {\n      this.userEditFlag = false;\n      this.userAddFlag = false;\n    },\n    initial() {\n      this.userEditFlag = false;\n      this.userAddFlag = false;\n      this.username = \"\";\n      this.majorName = \"\";\n      this.statusName = \"\";\n      this.currentPage = 1;\n      getUser().then(res => {\n        var _this = this;\n        function getStatusDate(i) {\n          var borrowDate = Math.round(new Date(i.date) / 1000); //结束日期\n          var backDate = borrowDate + 86400 * 15; //根据借书日期计算出归还日期\n          var currentDate = new Date() / 1000; //当前日期\n          if (backDate - currentDate > 0) {\n            //未逾期\n            _this.statusList.push(i.date);\n          }\n        }\n\n        // console.log(res);\n        res.map(item => {\n          getStatusDate(item);\n          if (this.majorList.indexOf(item.major) == -1) {\n            this.majorList.push(item.major);\n          }\n        });\n        console.log(this.statusList);\n        this.getUserInfo(res);\n      });\n    },\n    getUserInfo(data) {\n      this.alluserdata = data;\n      this.total = data.length;\n      this.changePage(1);\n    },\n    changePage(index) {\n      var start = (index - 1) * this.pageSize;\n      var end = start + this.pageSize;\n      this.userdata = this.alluserdata.slice(start, end);\n    },\n    selectStatus(n) {\n      this.userEditFlag = false;\n      this.userAddFlag = false;\n      this.username = \"\";\n      this.majorName = \"\";\n      this.statusName = n;\n      console.log(this.statusList);\n      getUser().then(res => {\n        if (n == \"未逾期\") {\n          this.getUserInfo(\n            res.filter(item => this.statusList.indexOf(item.date) > -1)\n          );\n        } else {\n          this.getUserInfo(\n            res.filter(item => this.statusList.indexOf(item.date) == -1)\n          );\n        }\n      });\n    },\n    selectMajor(name) {\n      this.userEditFlag = false;\n      this.userAddFlag = false;\n      this.username = \"\";\n      this.majorName = \"\";\n      // console.log(name);\n      this.majorName = name;\n      getUser().then(res => {\n        this.getUserInfo(res.filter(item => item.major == name));\n      });\n    },\n    selectAll() {\n      this.initial();\n    },\n    searchUserName() {\n      if (this.username) {\n        getUser().then(res => {\n          let arr = res.filter(item => item.name.indexOf(this.username) > -1);\n          if (arr.length <= 0) {\n            this.$Message.error(\"没有找到相关借阅人!\");\n          } else {\n            this.majorName = null;\n            this.getUserInfo(arr);\n          }\n        });\n      } else {\n        this.$Message.error(\"内容为空!\");\n      }\n    }\n  }\n};\n</script>\n\n<style scoped>\n.main {\n  width: 100%;\n  height: 100%;\n  padding: 10px;\n}\n.page {\n  text-align: center;\n  margin: 10px 0;\n}\n.toplist {\n  display: flex;\n}\n</style>"]}]}